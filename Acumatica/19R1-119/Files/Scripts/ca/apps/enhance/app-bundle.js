define("apps/enhance/controls/index",["require","exports","./qp-color-picker"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});function r(e){e.globalResources([i.QpColorPickerCustomElement])}t.configure=r});define("apps/enhance/controls/qp-color-picker",["require","exports","tslib","aurelia-framework"],function(e,t,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=true;var s=document.createElement("input");s.setAttribute("type","color");s.value="a";if(s.value==="a"){n=false}var o=function(){function e(e,t,i){this.element=e;this.em=t;this.taskQueue=i;this.supportsColor=n}e.prototype.attached=function(){var e=this;this.editor=this.element.querySelector("input[type=color]");for(var t=0;t<this.editor.classList.length;t++){var i=this.editor.classList.item(t);if(i.startsWith("size")){this.element.classList.add(i);break}}this.editorObject=this.editor.object;this.focusSubscription=this.em.addEventListener(this.editor,"focus",function(t){e.textInput.focus()},r.delegationStrategy.none,true);this.color=this.editorObject.getValue();this.disabled=this.editor.hasAttribute("readonly")?true:undefined;this.tabIndex=this.editor.tabIndex;this.textInput.tabIndex=this.tabIndex;if(this.colorInput){this.colorInput.tabIndex=this.tabIndex}this.editor.tabIndex=-1;this.overrideEditorSetValue();this.editor.classList.add("hidden")};e.prototype.overrideEditorSetValue=function(){var e=this;var t=this.editorObject.setValue;this.editorObject.setValue=function(i){e.disabled=e.editor.hasAttribute("readonly")?true:undefined;e.color=i;t.call(e.editorObject,i)}};e.prototype.detached=function(){this.focusSubscription.dispose()};e.prototype.updateTarget=function(){var e=this;this.taskQueue.queueTask(function(){e.editorObject.updateValue(e.color)})};e.prototype.bind=function(){};e.prototype.colorChanged=function(e){var t=this;if(n){return}var i=/^#[a-f\d]{6}$/i;var r=i.test(e);if(!r){this.taskQueue.queueTask(function(){var e=t.color="#000000"})}};i.__decorate([r.observable,i.__metadata("design:type",String)],e.prototype,"color",void 0);e=i.__decorate([r.customElement("qp-color-picker"),r.autoinject,i.__metadata("design:paramtypes",[Element,r.EventManager,r.TaskQueue])],e);return e}();t.QpColorPickerCustomElement=o});define("text!apps/enhance/controls/qp-color-picker.css",[],function(){return"qp-color-picker .hidden {\r\n  position: absolute;\r\n  -webkit-transform: translate(-9999px, -9999px);\r\n          transform: translate(-9999px, -9999px);\r\n}\r\n"});define("text!apps/enhance/controls/qp-color-picker.html",[],function(){return'<template style="display:inline-block">  \r\n  <require from="./qp-color-picker.css"></require>\r\n  <slot></slot>\r\n  <div style="display:flex">\r\n    <input if.bind="supportsColor" disabled.bind="disabled" ref="colorInput" class="editor" style="flex:1 1 auto" type="color"\r\n    value.bind="color" change.trigger="updateTarget()">\r\n    <span else css="background-color:${color};flex:1 1 auto;min-width:60px;"></span>\r\n    <input class="editor size-xs" blur.trigger="updateTarget()" disabled.bind="disabled" ref="textInput" style="flex:0 1 auto" type="text" value.bind="color & updateTrigger:\'blur\'">\r\n  </div>\r\n</template>\r\n'});define("apps/enhance/elements/index",["require","exports","./qp-editor-wrapper"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});function r(e){e.globalResources([i.QpEditorWrapperCustomElement])}t.configure=r});define("apps/enhance/elements/qp-editor-wrapper",["require","exports","tslib","aurelia-framework","aurelia-logging"],function(e,t,i,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var s=n.getLogger("qp-editor-wrapper");var o=function(){function e(e,t){this.element=e;this.tq=t}e.prototype.attached=function(){this.editor=this.element.querySelector(".editor");if(this.editor){this.editor.setAttribute("autocomplete","new-password")}this.selector=this.element.querySelector(".selector");this.rectElement=this.selector||this.editor;if(!this.selector){s.warn("no selector",this.element)}else{if(!this.selector.object){s.error("no object",this.selector)}else{this.selector.object.autoComplete=0}}};e.prototype.setEditorValue=function(e,t,i){if(this.selector&&this.selector.object){var r=this.selector.object;if(this.editor.value.trim()===""){r.setValue("","")}var n=r.hasHint?e+" - "+t:t;if(i){r.updateValue(e,n)}else{if(r.textField&&r.textMode===2){this.editor.value=t}else{this.editor.value=e}this.tq.queueTask(function(){return r.setHintText(n,true)})}}else{s.warn("no px object")}};i.__decorate([r.bindable({defaultBindingMode:r.bindingMode.oneTime}),i.__metadata("design:type",Object)],e.prototype,"config",void 0);e=i.__decorate([r.autoinject,r.customElement("qp-editor-wrapper"),i.__metadata("design:paramtypes",[Element,r.TaskQueue])],e);return e}();t.QpEditorWrapperCustomElement=o});define("text!apps/enhance/elements/qp-editor-wrapper.html",[],function(){return'<template>\r\n  <require from="./qp-suggester"></require>\r\n  <slot></slot>\r\n  <qp-suggester if.bind="config.suggester && editor" editor.two-way="editor" rect-element.bind="rectElement"\r\n    set-editor-value.call="setEditorValue(value,display,useUpdateValue)" config.bind="config.suggester"></qp-suggester>\r\n</template>\r\n'});define("apps/enhance/elements/qp-suggester",["require","exports","tslib","aurelia-framework","aurelia-logging","../services/suggestings-service","aurelia-event-aggregator","apps/enhance/services/localization"],function(e,t,i,r,n,s,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:true});var u=n.getLogger("qp-suggester");var l=function(){function e(e,t,i,r){this.eventManager=e;this.suggestingServiceFabric=t;this.eventAggregator=i;this.taskQueue=r;this.eventSubscriptions=[];this.debounceState={timeoutId:undefined,delay:250};this.localizedStrings=a.LocalizedStrings}e.prototype.bind=function(){this.config.suggestAfter=this.config.suggestAfter||2;var e=[this.config.valueField&&this.config.valueField.toLowerCase(),this.config.descriptionName&&this.config.descriptionName.toLowerCase()].filter(function(e){return e!=null});this.fieldsToRequest=this.config.fields.filter(function(t){return e.includes(t.id.toLowerCase())})};e.prototype.attached=function(){var e=this;this.eventSubscriptions.push(this.eventManager.addEventListener(this.editor,"input",function(t){return e.handleEditorInput(t)},r.delegationStrategy.capturing,true));this.eventSubscriptions.push(this.eventManager.addEventListener(this.editor,"keydown",function(t){return e.handleEditorKeyDown(t)},r.delegationStrategy.capturing,true));this.eventSubscriptions.push(this.eventManager.addEventListener(this.editor,"blur",function(t){return e.handleEditorBlur(t)},r.delegationStrategy.capturing,true));this.eventSubscriptions.push(this.eventManager.addEventListener(this.editor,"focus",function(t){return e.handleEditorFocus(t)},r.delegationStrategy.capturing,true));this.eventSubscriptions.push(this.eventManager.addEventListener(this.editor,"click",function(t){return e.handleEditorClick(t)},r.delegationStrategy.capturing,true));if(document.activeElement===this.editor){this.ensureSuggesterService();this.focused=true}};e.prototype.detached=function(){this.eventSubscriptions.forEach(function(e){return e.dispose()});this.eventSubscriptions=[];this.loading=undefined};e.prototype.handleEditorClick=function(e){u.info("click");if(e.altKey&&!e.ctrlKey){e.preventDefault();e.stopImmediatePropagation();this.MoveHighligt(1)}return true};e.prototype.handleEditorFocus=function(e){this.ensureSuggesterService();this.focused=true;u.info("focus");return true};e.prototype.handleEditorBlur=function(e){u.info("blur");this.focused=false;this.suggestingsService.abortRequest();this.hideSuggestions();return true};e.prototype.handleEditorKeyDown=function(e){u.info("keydown");switch(e.key){case"Esc":case"Escape":if(this.suggesting){this.hideSuggestions();e.preventDefault();e.stopImmediatePropagation()}break;case"Enter":if(this.suggesting){this.select(this.highlightedSugestionIndex)}return true;break;case"Up":case"ArrowUp":if(!!this.suggesting!==e.altKey){e.preventDefault();e.stopImmediatePropagation();this.MoveHighligt(-1)}break;case"Down":case"ArrowDown":if(!!this.suggesting!==e.altKey){e.preventDefault();e.stopImmediatePropagation();this.MoveHighligt(1)}break;case"PageDown":e.preventDefault();e.stopImmediatePropagation();this.MoveHighligt(7);break;case"PageUp":e.preventDefault();e.stopImmediatePropagation();this.MoveHighligt(-7);break;default:return true}};e.prototype.handleEditorInput=function(e){var t=this;u.info("input");this.loading=true;var i=this.editor.value;if(i.length>=this.config.suggestAfter||this.suggesting){clearTimeout(this.debounceState.timeoutId);this.debounceState.timeoutId=setTimeout(function(){return t.suggestingsService.getSuggestions(i).then(function(e){t.suggestions=e;t.showSuggestions();t.loading=false}).catch(function(e){if(e.name==="AbortError"){u.info("suggestions request aborted by user input")}else{throw e}})},this.debounceState.delay)}};e.prototype.ignoreClicks=function(e){e.preventDefault()};e.prototype.getDocumentRect=function(){var e=document.body.getBoundingClientRect(),t=e.top,i=e.left,r=e.width,n=e.height,s=e.bottom,o=e.right;return{top:t,left:i,width:r,height:n,bottom:s,right:o}};e.prototype.calculateSuggesterPosition=function(){var e=this.getDocumentRect();var t=this.rectElement.getBoundingClientRect(),i=t.top,r=t.left,n=t.width,s=t.height,o=t.bottom,a=t.right;this.suggesterPosition={top:i,left:r,width:n,height:s,bottom:o,right:a};if(!this.suggesting){this.showAbove=i+168>e.bottom}if(this.showAbove){this.suggesterPosition.top=i}else{this.suggesterPosition.top=o}this.showLeft=r+Math.min(386,this.suggesterWidth)>e.width;if(this.showLeft){var u=Math.max(a,e.right);this.suggesterPosition.left=u}};e.prototype.showSuggestions=function(){var e=this;this.highlightedSugestionIndex=0;if(this.suggesting||!this.focused){return}this.suggesterWidth=undefined;this.calculateSuggesterPosition();this.suggesting=true;this.viewPortSubscription=this.eventAggregator.subscribe("absolute-positions-are-screwed",function(){e.calculateSuggesterPosition()});this.taskQueue.queueTask(function(){if(e.suggestionsContainer){var t=e.suggestionsContainer.getBoundingClientRect().width;e.suggesterWidth=t;e.calculateSuggesterPosition()}})};e.prototype.debounceHoverHighlight=function(){var e=this;this.preventHoverHighlight=true;clearTimeout(this.preventHoverHighlightTimeout);this.preventHoverHighlightTimeout=setTimeout(function(){e.preventHoverHighlight=false},32)};e.prototype.hideSuggestions=function(){if(!this.suggesting){return}this.suggesting=false;this.suggestions=undefined;this.viewPortSubscription.dispose()};e.prototype.changeHighLight=function(e){this.highlightedSugestionIndex=e};e.prototype.handleScroll=function(e){this.debounceHoverHighlight();var t=e.srcElement;if(!this.suggestions.loading&&this.suggestions.haveMore&&t.scrollTop+t.clientHeight+7*24>t.scrollHeight){this.suggestions.loadMore()}};e.prototype.ensureSuggesterService=function(){var e=this;var t=this.suggestingsService===undefined||this.config.inlineArgs;var i;if(this.config.dependsOn&&this.config.dependsOn.length){i=this.config.dependsOn.map(function(t){return{id:t.id,value:__px_all(e.editor)[t.controlID].value}});var r=JSON.stringify(i);if(this.serializedArgs!==r){t=true;this.serializedArgs=r}}if(t){this.suggestingsService=this.suggestingServiceFabric.getSuggestingService({args:i,fields:this.fieldsToRequest,graph:this.config.graph,viewName:this.config.viewName,inlineArgs:this.config.inlineArgs,pageSize:7,serverFiltering:this.config.serverFiltering,valueField:this.config.valueField,descriptionName:this.config.descriptionName})}};e.prototype.MoveHighligt=function(e){return i.__awaiter(this,void 0,void 0,function(){var t,r;var n=this;return i.__generator(this,function(i){switch(i.label){case 0:if(!!this.suggesting)return[3,3];if(!!this.suggestions)return[3,2];this.loading=true;return[4,this.suggestingsService.getSuggestions("").then(function(e){n.suggestions=e;n.loading=false}).catch(function(e){if(e.name==="AbortError"){u.info("suggestions request aborted by user input")}else{throw e}})];case 1:i.sent();i.label=2;case 2:this.showSuggestions();return[2];case 3:this.highlightedSugestionIndex+=e;if(this.highlightedSugestionIndex<0){this.highlightedSugestionIndex=0}if(this.highlightedSugestionIndex>this.suggestions.suggestionItems.length-1){this.highlightedSugestionIndex=this.suggestions.suggestionItems.length-1}if(Math.abs(e)>1){if(e>0){t="start";this.suggestionsContainer.scrollTop=this.suggestionsContainer.scrollTop+this.suggestionsContainer.clientHeight}else{this.suggestionsContainer.scrollTop=this.suggestionsContainer.scrollTop-this.suggestionsContainer.clientHeight;t="end"}}else{}t="nearest";r=this.suggestionsContainer.querySelectorAll("qp-suggestion")[this.highlightedSugestionIndex];if(r){if("scrollBehavior"in document.documentElement.style){r.scrollIntoView({block:t})}else{r.scrollIntoView(e<0)}}return[2]}})})};e.prototype.select=function(e,t){if(t===void 0){t=undefined}var i=this.suggestions.suggestionItems[e];this.setEditorValue({value:i.value,display:i.display,useUpdateValue:!!t});if(t){t.preventDefault();t.stopImmediatePropagation()}this.hideSuggestions()};i.__decorate([r.bindable,i.__metadata("design:type",HTMLElement)],e.prototype,"editor",void 0);i.__decorate([r.bindable,i.__metadata("design:type",HTMLElement)],e.prototype,"rectElement",void 0);i.__decorate([r.bindable,i.__metadata("design:type",Function)],e.prototype,"setEditorValue",void 0);i.__decorate([r.bindable,i.__metadata("design:type",Object)],e.prototype,"config",void 0);e=i.__decorate([r.autoinject,i.__metadata("design:paramtypes",[r.EventManager,s.SuggestingsServiceFabric,o.EventAggregator,r.TaskQueue])],e);return e}();t.QpSuggesterCustomElement=l});define("text!apps/enhance/elements/qp-suggester.css",[],function(){return"/* qp-editor-wrapper,\r\nqp-editor-wrapper * {\r\n  box-sizing: border-box;\r\n\r\n} */\r\n\r\nqp-suggester {\r\n  display: block;\r\n  position: absolute;\r\n  /* z-index: 1000; */\r\n  top: 100%;\r\n  /* overflow: hidden; */\r\n\r\n\r\n}\r\n\r\n.qp-suggester,\r\n.qp-suggester * {\r\n  box-sizing: border-box;\r\n\r\n\r\n}\r\n\r\n.qp-suggester.loading{\r\n  -webkit-filter:grayscale(.5);\r\n          filter:grayscale(.5);\r\n}\r\n.qp-suggester.show-above {\r\n  -webkit-transform:translateY(-100%);\r\n          transform:translateY(-100%);\r\n  -webkit-transform:translateY(calc(-100% - 1px));\r\n          transform:translateY(calc(-100% - 1px));\r\n}\r\n\r\n.qp-suggester.show-left {\r\n  -webkit-transform:translateX(-100%);\r\n          transform:translateX(-100%);  \r\n}\r\n\r\n.qp-suggester.show-left.show-above {\r\n  -webkit-transform:translate(-100%,-100%);\r\n          transform:translate(-100%,-100%);  \r\n}\r\n\r\nqp-suggestion {\r\n  display: block;\r\n  height:24px;\r\n  padding: 4px 6px;\r\n  font-size: 13px;\r\n  white-space: nowrap;\r\n  overflow: hidden;\r\n  text-overflow: ellipsis;\r\n  cursor: pointer;\r\n}\r\n\r\n.loading-placeholder.loading {\r\n  position: relative;\r\n}\r\n.loading-placeholder.loading:before{\r\n  position: absolute;\r\n  top:2px;\r\n  left: 5px;\r\n  right:5px;\r\n  bottom: 2px;\r\n  content:'';\r\n  background-color: #ccc;\r\n}\r\n"});define("text!apps/enhance/elements/qp-suggester.html",[],function(){return'<template>\r\n  <require from="./qp-suggester.css"></require>\r\n  <div if.bind="suggesting && suggestions" ref="suggestionsContainer" portal class="qp-suggester ${showAbove?\'show-above\':\'\'} ${showLeft?\'show-left\':\'\'} ${loading || suggestions.loading ?\'loading\':\'\'}"\r\n    css="position: fixed; max-height:168px;overflow-y:auto; top: ${suggesterPosition.top}px; ${suggesterWidth?\'width:\'+suggesterWidth+\'px;\':\'\' } left: ${suggesterPosition.left}px; min-width:${suggesterPosition.width}px; background-color:white; max-width:386px;"\r\n    scroll.trigger="handleScroll($event)" mousedown.delegate="ignoreClicks($event)">\r\n\r\n\r\n    <qp-suggestion repeat.for="i of suggestions.suggestionItems" class="${$index==highlightedSugestionIndex?\'suggestion-highlight\':\'\'}" mouseenter.capture="changeHighLight($index)" click.delegate="select($index,$event)">\r\n      <template repeat.for="s of i.segments"><mark if.bind="s.highlight">${s.text}</mark><template else>${s.text}</template></template>\r\n    </qp-suggestion>\r\n    <qp-suggestion if.bind="suggestions.haveMore" repeat.for="i of 1" class="loading-placeholder ${suggestions.loading}"></qp-suggestion>\r\n    <div if.bind="suggestions.totalCount==0" style="padding:5px .5em;color:#888;font-size:13px;white-space:nowrap;text-overflow:ellipsis;">\r\n\r\n      <svg xmlns="http://www.w3.org/2000/svg" width=16 height=16 viewBox="0 0 16 16" style="vertical-align:bottom;margin-right:.5em;"\r\n        fill="currentColor">\r\n        <g id="sad" stroke="none" stroke-width=".8" fill="none" fill-rule="evenodd">\r\n          <g id="Group" fill="#c8930c">\r\n            <circle cx="10.84" cy="5.68" r="1.03"></circle>\r\n            <circle cx="5.16" cy="5.68" r="1.03"></circle>\r\n            <path d="M8,0 C3.58177778,0 0,3.58177778 0,8 C0,12.4182222 3.58177778,16 8,16 C12.4182222,16 16,12.4182222 16,8 C16,3.58177778 12.4182222,0 8,0 Z M8,14.6671111 C4.31822222,14.6671111 1.33333333,11.6822222 1.33333333,8.00044444 C1.33333333,4.31844444 4.31822222,1.33333333 8,1.33333333 C11.6822222,1.33333333 14.6671111,4.31822222 14.6671111,8.00022222 C14.6671111,11.6822222 11.6822222,14.6671111 8,14.6671111 Z"\r\n              fill-rule="nonzero"></path>\r\n            <path d="M11.1988131,12.3870968 C10.9618705,12.3870968 10.7318091,12.2666654 10.6093237,12.0538815 C10.0854351,11.1424204 9.08513805,10.5760202 7.99974353,10.5760202 C6.91411964,10.5760202 5.914052,11.1424204 5.39016335,12.0538815 C5.21125217,12.3649409 4.80250892,12.4785719 4.47748694,12.307248 C4.15223558,12.1363627 4.03342021,11.7454545 4.21233139,11.434395 C4.97247455,10.1118441 6.42394887,9.29032258 7.99997291,9.29032258 C9.57576756,9.29032258 11.0274713,10.1120635 11.7876144,11.434395 C11.9665256,11.7454545 11.8479396,12.1361433 11.5226882,12.307248 C11.4194703,12.3614311 11.3084536,12.3870968 11.1988131,12.3870968 Z"></path>\r\n          </g>\r\n        </g>\r\n      </svg>\r\n      ${localizedStrings.noResultsFound}\r\n    </div>\r\n  </div>\r\n</template>\r\n'});define("apps/enhance/main",["require","exports","tslib","aurelia-bootstrapper","environment","./services/screen-observer"],function(e,t,i,r,n,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});n=i.__importDefault(n);var o=document.activeElement;if(o&&o.tagName=="BODY"){document.addEventListener("focus",function(e){o=e.target},{capture:true,once:true})}var a=function(e){return i.__awaiter(this,void 0,void 0,function(){return i.__generator(this,function(t){switch(t.label){case 0:e.use.basicConfiguration().defaultResources().plugin("aurelia-portal-attribute").feature("apps/enhance/elements").feature("apps/enhance/controls");e.use.developmentLogging(n.default.debug?"debug":"warn");e.container.registerSingleton(s.ScreenObserver);return[4,e.start()];case 1:t.sent();e.container.get(s.ScreenObserver);e.enhance().then(function(e){o&&o.focus()});return[2]}})})};r.bootstrap(a)});define("apps/enhance/model/index",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true})});define("apps/enhance/services/api-client",["require","exports","tslib","aurelia-fetch-client","aurelia-framework","whatwg-fetch","abortcontroller-polyfill/dist/abortcontroller-polyfill-only"],function(e,t,i,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var s=function(){function e(e){this.client=e;this.root="";this.root=requirejs.s.contexts._.config.baseUrl.replace("/scripts/ca/","");this.client.configure(function(e){e.withDefaults({credentials:"same-origin",headers:{Accept:"application/json","X-Requested-With":"Fetch"}})})}e.prototype.getSuggestionData=function(e,t){return this.client.fetch(this.root+"/ui/Selector/Pass",{method:"POST",body:r.json(e),signal:t}).then(function(e){return e.json()})};e=i.__decorate([n.autoinject,i.__metadata("design:paramtypes",[r.HttpClient])],e);return e}();t.ApiClient=s});define("apps/enhance/services/localization",["require","exports","aurelia-pal"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.LocalizedStrings=i.PLATFORM.global.ClientLocalizedStrings;t.default=t.LocalizedStrings});define("apps/enhance/services/screen-observer",["require","exports","tslib","aurelia-framework","aurelia-event-aggregator","aurelia-logging"],function(e,t,i,r,n,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});var o=s.getLogger("screen-observer");var a=function(){function e(e,t,i,r,n){this.eventAggregator=e;this.eventManager=t;this.engine=i;this.container=r;this.au=n;this.ticking=false;this.attachScreen();var s=[];var o=this.au.resources.elements;for(var a in o){if(a){s.push(o[a].elementName)}}this.enhanceSelector=s.join(",")}e.prototype.attachScreen=function(){var e=this;this.eventManager.addEventListener(document,"scroll",function(t){e.notifyAbsolutePositionsAreScrewed(t)},r.delegationStrategy.capturing,true);this.eventManager.addEventListener(window,"resize",function(t){e.notifyAbsolutePositionsAreScrewed(t)},r.delegationStrategy.none,true);var t=new MutationObserver(function(t){e.onMutationcallback(t)});t.observe(document,{childList:true,subtree:true})};e.prototype.notifyAbsolutePositionsAreScrewed=function(e){var t=this;if(!this.ticking){this.ticking=true;requestAnimationFrame(function(){t.eventAggregator.publish("absolute-positions-are-screwed");t.ticking=false})}};e.prototype.onMutationcallback=function(e){for(var t=0,i=e;t<i.length;t++){var r=i[t];if(r.type=="childList"){for(var n=0;n<r.addedNodes.length;n++){var s=r.addedNodes[n];if(s.nodeType!=Node.ELEMENT_NODE){continue}var a=void 0;if(this.au.resources.getElement(s.nodeName.toLowerCase())){a=[s]}else{a=s.querySelectorAll(this.enhanceSelector)}for(var u=0;u<a.length;u++){var l=a[u];if(l.getAttribute("au-target-id")){o.warn("node already enchanced",l);l.au.controller.attached()}else{this.engine.enhance({element:l,container:this.container,resources:this.au.resources})}}}for(var n=0;n<r.removedNodes.length;n++){var s=r.removedNodes[n];if(s.nodeType!=Node.ELEMENT_NODE){continue}var a=void 0;if(this.au.resources.getElement(s.nodeName.toLowerCase())){a=[s]}else{a=s.querySelectorAll(this.enhanceSelector)}for(var u=0;u<a.length;u++){var l=a[u];if(!l.au){o.warn("no au-target-id on removed node",l)}if(l.getAttribute("au-target-id")){l.au.controller.detached()}}}}}};e=i.__decorate([r.autoinject,i.__metadata("design:paramtypes",[n.EventAggregator,r.EventManager,r.TemplatingEngine,r.Container,r.Aurelia])],e);return e}();t.ScreenObserver=a});define("apps/enhance/services/suggestings-service",["require","exports","tslib","./api-client","aurelia-framework"],function(e,t,i,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});function s(e,t){if(!e){return[{text:t,highlight:false}]}var i=e.split(" ").filter(function(e){return e.length>0}).map(function(e){var t=e.toUpperCase();var i=t.length;return{str:t,len:i}});var r=t.toUpperCase();var n=Array.from({length:r.length});for(var s=0;s<n.length;s++){n[s]=false}var o=[];i.forEach(function(e){var t=0;var i=-1;do{i=r.indexOf(e.str,t);if(i>-1){for(var s=i;s<i+e.len;s++){n[s]=true}t=i+e.len}}while(i>-1)});var a=false;var u=0;do{var l=u;while(n[u]===a&&u<n.length){u++}if(u>l){o.push({text:t.substring(l,u),highlight:a})}a=n[u]}while(u<n.length);return o}var o=function(){function e(e,t){this.params=e;this.apiClient=t;this.results=new Map;this.baseQuery={fields:this.params.fields,graph:this.params.graph,view:this.params.viewName,filter:"",inlineArgs:this.params.inlineArgs,take:this.params.pageSize,skip:0,args:e.args}}e.prototype.abortRequest=function(){if(this.abortController){if(!this.abortController.signal.aborted){this.abortController.abort()}}};e.prototype.getData=function(e){return i.__awaiter(this,void 0,void 0,function(){var t=this;return i.__generator(this,function(i){this.abortRequest();this.abortController=new AbortController;return[2,this.apiClient.getSuggestionData(e,this.abortController.signal).then(function(i){if(!i.data||!i.fields){return{haveMore:false,totalCount:0,suggestionItems:[],loading:false}}else{var r=i.fields.findIndex(function(e){return e.toLowerCase()==t.params.valueField.toLowerCase()});var n=i.fields.length>1&&t.params.descriptionName!==t.params.valueField?i.fields.findIndex(function(e){return e.toLowerCase()==t.params.descriptionName.toLowerCase()}):-1;var o={haveMore:i.haveMore,totalCount:i.totalCount,loading:false,suggestionItems:i.data.map(function(t){var i=t[r];var o=n===-1?null:t[n];var a=s(e.filter,o?i+" - "+o:""+i);return{value:i,display:o,segments:a}})};return o}})]})})};e.prototype.getSuggestions=function(e){return i.__awaiter(this,void 0,void 0,function(){var t;var r=this;return i.__generator(this,function(n){if(!this.results.has(e)){t=i.__assign({},this.baseQuery,{filter:e},{take:this.params.pageSize*2});return[2,this.getData(t).then(function(n){if(n.haveMore){n.loadMore=function(){if(n.loading){return}n.loading=true;var e=i.__assign({},t,{skip:n.suggestionItems.length,take:r.params.pageSize});r.getData(e).then(function(e){var t;n.haveMore=e.haveMore;n.totalCount=e.totalCount;(t=n.suggestionItems).push.apply(t,e.suggestionItems);n.loading=false})}}r.results.set(e,n);return r.results.get(e)})]}return[2,Promise.resolve(this.results.get(e))]})})};return e}();t.SuggestingsService=o;var a=function(){function e(e){this.apiClient=e}e.prototype.getSuggestingService=function(e){return new o(e,this.apiClient)};e=i.__decorate([n.autoinject,i.__metadata("design:paramtypes",[r.ApiClient])],e);return e}();t.SuggestingsServiceFabric=a;var u=function(){function e(){}return e}();t.Suggestions=u});